<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using mosaicModel • mosaicModel</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using mosaicModel">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mosaicModel</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.3.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Basics.html">Using mosaicModel</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ProjectMOSAIC/mosaicModel">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Using mosaicModel</h1>
                        <h4 class="author">Daniel Kaplan</h4>
            
            <h4 class="date">2018-11-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ProjectMOSAIC/mosaicModel/blob/master/vignettes/Basics.Rmd"><code>vignettes/Basics.Rmd</code></a></small>
      <div class="hidden name"><code>Basics.Rmd</code></div>

    </div>

    
    
<p>The <code>mosaicModel</code> package provides a basic interface for interpreting and displaying models. From the early beginnings of R, methods such as <code>summary()</code>, <code>plot()</code>, and <code>predict()</code> provided a consistent vocabulary for generating model output and reports, but the format and contents of those reports depended strongly on the specifics of the model architecture. For example, for architectures such as <code>lm()</code> and <code>glm()</code>, the <code>summary()</code> method produces a regression table showing point estimates and standard errors on model coefficients. But other widely used architectures such as random forests or k-nearest neighbors do not generate coefficients and so need to be displayed and interpreted in other ways.</p>
<p>To provide a general interface for displaying and interpreting models, the <code>mosaicModel</code> package provides an alternative set of functions that make sense for a wide range of model types, including those typically grouped under the term “machine learning,” but work more consistently across this wide range of model types.</p>
<ul>
<li>
<code><a href="../reference/mod_eval.html">mod_eval()</a></code> – evaluate a model, that is, turn inputs into model values and standard errors on those values.</li>
<li>
<code><a href="../reference/mod_plot.html">mod_plot()</a></code> – produce a graphical display of the “shape” of a model. There can be as many as 4 input variables shown, along with the output.</li>
<li>
<code><a href="../reference/mod_effect.html">mod_effect()</a></code> – calculate effect sizes, that is, how a change in an input variable changes the output</li>
<li>
<code><a href="../reference/mod_error.html">mod_error()</a></code> – find the mean square prediction error (or the log likelihood)</li>
<li>
<code><a href="../reference/mod_ensemble.html">mod_ensemble()</a></code> – create an ensemble of bootstrap replications of the model, that is, models fit to resampled data from the original model.</li>
<li>
<code><a href="../reference/mod_cv.html">mod_cv()</a></code> – carry out cross validation on one or more models.</li>
<li>
<code><a href="../reference/mod_fun.html">mod_fun()</a></code> – extract a function from a model that implements the inputs-to-output relationship.</li>
</ul>
<p><code>mosaicModel</code> stays out of the business of fitting and training models. You do that using functions provied elsewhere, for example using</p>
<ul>
<li>
<code>lm()</code> or <code>glm()</code> provided by the <code>stats</code> package for fitting linear or generalized linear models;</li>
<li>
<code><a href="http://www.rdocumentation.org/packages/caret/topics/train">train()</a></code> from the <code>caret</code> package for machine learning;</li>
<li>
<code>rpart()</code>, <code><a href="http://www.rdocumentation.org/packages/randomForest/topics/randomForest">randomForest()</a></code>, <code><a href="http://www.rdocumentation.org/packages/MASS/topics/rlm">rlm()</a></code>, and other functions provided by other packages.</li>
</ul>
<p>The package authors will try to expand the repertoire as demand requires. (See the section on <a href="#new-architectures">adding support for additional model types</a>.)</p>
<div id="introductory-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#introductory-examples" class="anchor"></a>Introductory examples</h2>
<p>This vignette is intended to be a concise introduction to the use of <code>mosaicModel</code> rather than a systematic introduction to modeling. To that end, we’ll use short, “simple,” and readily available data sets, <code>mtcars</code> and <code>iris</code>, which come already installed in R, and assume the reader already has a basic understanding of the models used in the examples.</p>
<p><code>mtcars</code> records fuel consumption (<code>mpg</code>) of 1973-74 model cars along with a variety of other attributes such as horsepower (<code>hp</code>), weight (<code>wt</code>), and transmission type (<code>am</code>). We’ll use <code>mtcars</code> for a <em>regression</em> problem: How do the different aspects of a car relate to its fuel consumption?</p>
<p><code>iris</code> records sepal width and length and petal width and length for 50 flowers of each of three species of iris. We’ll use <code>iris</code> for a <em>classification</em> problem: Given sepal and petal characteristics for a flower, which species is the flower likely to be?</p>
<p>We are not going to concern ourselves here with building good models, just demonstrating how models can be built and evaluated: the techniques you would need for building and refining models to serve your own purposes.</p>
<p>For both the fuel-consumption and iris-species problems, we’ll build two models. Refining and improving models is generally a matter of comparing models.</p>
<div id="fuel-consumption" class="section level3">
<h3 class="hasAnchor">
<a href="#fuel-consumption" class="anchor"></a>Fuel consumption</h3>
<p>To indicate some of the relationships in the <code>mtcars</code> data, here’s a simple visualization along with the command to make it using the <code>ggformula</code> package. (Note: in the first line of the command, we’re adding a categorical variable, <code>transmission</code>, to the existing quantitative variables in <code>mtcars</code> so that the examples can show both quantitative and categorical variables.)</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">mtcars &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">transmission =</span> <span class="kw">ifelse</span>(am, <span class="st">"manual"</span>, <span class="st">"automatic"</span>))</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">gf_point</span>(mpg <span class="op">~</span><span class="st"> </span>hp, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>transmission, <span class="dt">data =</span> mtcars)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="Basics_files/figure-html/fuel_intro-1.png" alt="A simple display of the `mtcars` data used in the example." width="45%"><p class="caption">
A simple display of the <code>mtcars</code> data used in the example.
</p>
</div>
<p>Now we fit two models using these data.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">fuel_mod_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>hp <span class="op">*</span><span class="st"> </span>transmission, <span class="dt">data =</span> mtcars)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">fuel_mod_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(hp, <span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>transmission, <span class="dt">data =</span> mtcars)</a></code></pre></div>
<p>The second model includes a nonlinear dependence on horsepower. You can think of <code>ns()</code> as standing for “not straight” with the integer describing the amount of “curviness” allowed.</p>
<p>For models involving only a very few explanatory variables, a plot of the model can give immediate insight. The <code><a href="../reference/mod_plot.html">mod_plot()</a></code> function reduces the work to make such a plot.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="../reference/mod_plot.html">mod_plot</a></span>(fuel_mod_<span class="dv">1</span>) </a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="../reference/mod_plot.html">mod_plot</a></span>(fuel_mod_<span class="dv">2</span>) </a></code></pre></div>
<p><img src="Basics_files/figure-html/unnamed-chunk-2-1.png" width="30%" style="display: block; margin: auto;"><img src="Basics_files/figure-html/unnamed-chunk-2-2.png" width="30%" style="display: block; margin: auto;"></p>
<p>Two important additional arguments to <code><a href="../reference/mod_plot.html">mod_plot()</a></code> are</p>
<ul>
<li><p>a formula specifying the role of each explanatory variable. For instance, the formula <code>~ transmission + hp</code> would put the categorical transmission variable on the x-axis and use <code>hp</code> for color. Additional variables, if any, get used for faceting the graphic.</p></li>
<li><p>An <code>interval=</code> argument, which, for many regression model types, can be set to <code>"prediction"</code> or <code>"confidence"</code>.</p></li>
</ul>
</div>
<div id="iris-species" class="section level3">
<h3 class="hasAnchor">
<a href="#iris-species" class="anchor"></a>Iris species</h3>
<p>The <code>iris</code> dataset has four explanatory variables. Here’s species shown as a function of two of the variables:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">gf_point</span>(Sepal.Length <span class="op">~</span><span class="st"> </span>Petal.Length, <span class="dt">color =</span> <span class="op">~</span><span class="st"> </span>Species, <span class="dt">data =</span> iris) </a></code></pre></div>
<p><img src="Basics_files/figure-html/unnamed-chunk-3-1.png" width="45%" style="display: block; margin: auto;"> For later comparison to the models that we’ll train, note that when the petal length and sepal length are both large, the flowers are almost always <em>virginica</em>.</p>
<p>Again, to illustrate how the <code>mosaicModel</code> package works, we’ll build two classifiers for the iris species data: a random forest using two of the available explanatory variables and a k-nearest neighbors classifier. (The period in the formula <code>Species ~ .</code> indicates that all variables should be used except the outcome variable.)</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">library</span>(randomForest)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">iris_mod_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/randomForest/topics/randomForest">randomForest</a></span>(Species <span class="op">~</span><span class="st"> </span>Sepal.Length <span class="op">+</span><span class="st"> </span>Petal.Length, <span class="dt">data =</span> iris)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw">library</span>(caret)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">iris_mod_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/caret/topics/knn3">knn3</a></span>(Species <span class="op">~</span>., <span class="dt">data =</span> iris, <span class="dt">k =</span> <span class="dv">15</span>)</a></code></pre></div>
<p>Notice that these models are trained using functions that come from two different packages: <code><a href="http://www.rdocumentation.org/packages/randomForest/topics/randomForest">randomForest()</a></code> comes from <code>randomForest</code> and <code><a href="http://www.rdocumentation.org/packages/caret/topics/knn3">knn3()</a></code> from <code>caret</code>. <code>mosaicModel</code> does not provide alternatives or replacements for these functions but lets you use model-training functions from whatever packages you like.</p>
<p>Again, we can visualize the form of the function:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="../reference/mod_plot.html">mod_plot</a></span>(iris_mod_<span class="dv">1</span>)</a></code></pre></div>
<p><img src="Basics_files/figure-html/unnamed-chunk-5-1.png" width="45%" style="display: block; margin: auto;"></p>
<p>Since this is a classifier, the plot of the model function shows the <em>probability</em> of one of the output classes. That’s <em>virginica</em> here. When the petal length is small, say around 1, the flower is very unlikely to be <em>virginica</em>. But for large petal lengths, and especially for large petal lengths and large sepal lengths, the flower is almost certain to be <em>virginica</em>.</p>
<p>If your interest is in a class other than <em>virginica</em>, you can specify the class you want with an additional argument, e.g. <code>class_level = "setosa"</code>.</p>
<p>The second iris model has four explanatory variables. This is as many as <code><a href="../reference/mod_plot.html">mod_plot()</a></code> will display:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../reference/mod_plot.html">mod_plot</a></span>(iris_mod_<span class="dv">2</span>, <span class="dt">class_level =</span> <span class="st">"setosa"</span>)</a></code></pre></div>
<p><img src="Basics_files/figure-html/unnamed-chunk-6-1.png" width="80%" style="display: block; margin: auto;"> The plot shows that the flower species does not depend on either of the two variables displayed on the x-axis and with color: the sepal width and the sepal length. This is why the line is flat and the colors overlap. But you can easily see a dependence on petal width and, to a very limited extent, on petal length.</p>
<p>The choice of which role in the plot is played by which explanatory variable is up to you. Here the dependence on petal length and width are emphasized by using them for x-position and color:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="../reference/mod_plot.html">mod_plot</a></span>(iris_mod_<span class="dv">2</span>, <span class="op">~</span><span class="st"> </span>Petal.Length <span class="op">+</span><span class="st"> </span>Petal.Width)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw"><a href="../reference/mod_plot.html">mod_plot</a></span>(iris_mod_<span class="dv">2</span>, <span class="op">~</span><span class="st"> </span>Petal.Length <span class="op">+</span><span class="st"> </span>Petal.Width <span class="op">+</span><span class="st"> </span>Sepal.Width)</a></code></pre></div>
<p><img src="Basics_files/figure-html/unnamed-chunk-7-1.png" width="45%" style="display: block; margin: auto;"><img src="Basics_files/figure-html/unnamed-chunk-7-2.png" width="45%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="model-outputs" class="section level2">
<h2 class="hasAnchor">
<a href="#model-outputs" class="anchor"></a>Model outputs</h2>
<p>The <code><a href="../reference/mod_plot.html">mod_plot()</a></code> function creates a graphical display of the output of the model for a range of model inputs. The <code><a href="../reference/mod_eval.html">mod_eval()</a></code> function (which <code><a href="../reference/mod_plot.html">mod_plot()</a></code> uses internally), produces the output in tabular form, e.g.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="../reference/mod_eval.html">mod_eval</a></span>(fuel_mod_<span class="dv">1</span>, <span class="dt">transmission =</span> <span class="st">"manual"</span>, <span class="dt">hp =</span> <span class="dv">200</span>)</a></code></pre></div>
<pre><code>##    hp transmission model_output
## 1 200       manual     20.09568</code></pre>
<p><code><a href="../reference/mod_eval.html">mod_eval()</a></code> tries to do something sensible if you don’t specify a value (or a range of values) for an explanatory variable.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="../reference/mod_eval.html">mod_eval</a></span>(fuel_mod_<span class="dv">1</span>)</a></code></pre></div>
<pre><code>##    hp transmission model_output
## 1   0    automatic    26.624848
## 2 400    automatic     2.970055
## 3   0       manual    31.842501
## 4 400       manual     8.348865</code></pre>
<p>Another interface to evaluate the model is available in the form of a “model function.” This interface may be preferred in uses where the objective of modeling is to develop a function that can be applied in, say, calculus operations.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">f1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mod_fun.html">mod_fun</a></span>(fuel_mod_<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw">f1</span>(<span class="dt">hp =</span> <span class="dv">200</span><span class="op">:</span><span class="dv">203</span>, <span class="dt">transmission =</span> <span class="st">"manual"</span>)</a></code></pre></div>
<pre><code>##    hp transmission model_output
## 1 200       manual     20.09568
## 2 201       manual     20.03695
## 3 202       manual     19.97821
## 4 203       manual     19.91948</code></pre>
<p>You can also evaluate classifiers using <code><a href="../reference/mod_eval.html">mod_eval()</a></code> or <code><a href="../reference/mod_fun.html">mod_fun()</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="../reference/mod_eval.html">mod_eval</a></span>(iris_mod_<span class="dv">1</span>, <span class="dt">nlevels =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##   Sepal.Length Petal.Length setosa versicolor virginica
## 1            4            0  1.000      0.000     0.000
## 2            8            0  0.614      0.268     0.118
## 3            4           10  0.200      0.180     0.620
## 4            8           10  0.000      0.000     1.000</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">species &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mod_fun.html">mod_fun</a></span>(iris_mod_<span class="dv">1</span>, <span class="dt">nlevels =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw">species</span>(<span class="dt">Sepal.Length =</span> <span class="dv">4</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">Petal.Length =</span> <span class="dv">5</span>)</a></code></pre></div>
<pre><code>##   Sepal.Length Petal.Length setosa versicolor virginica
## 1            4            5  0.202      0.184     0.614
## 2            5            5  0.032      0.436     0.532</code></pre>
</div>
<div id="effect-sizes" class="section level2">
<h2 class="hasAnchor">
<a href="#effect-sizes" class="anchor"></a>Effect sizes</h2>
<p>It’s often helpful in interpreting a model to know how the output changes with a change in one of the inputs. Traditionally, model coefficients have been used for this purpose. But some models (random forests, for example) do not have model coefficients and even in those that do, the use of interactions and nonlinear terms spreads out the information across multiple coefficients.</p>
<p>As an alternative, <code><a href="../reference/mod_effect.html">mod_effect()</a></code> calculates a model input at one set of values, repeats the calculation after modifying a selected input, and combines the result into a “rate-of-change/slope” or a finite-difference.</p>
<p>Here, <code><a href="../reference/mod_effect.html">mod_effect()</a></code> is calculating the (average) rate of change of fuel consumption (remember, the output of <code>fuel_mod_1</code> is in terms of <code>mpg</code>) with respect to <code>hp</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="../reference/mod_effect.html">mod_effect</a></span>(fuel_mod_<span class="dv">2</span>, <span class="op">~</span><span class="st"> </span>hp)</a></code></pre></div>
<pre><code>##         slope  hp to_hp transmission
## 1 -0.06520024 120   170    automatic</code></pre>
<p>Since no specific inputs were specified, <code><a href="../reference/mod_effect.html">mod_effect()</a></code> attempted to do something sensible.</p>
<p>You can, of course, specify the inputs you want, for instance:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw"><a href="../reference/mod_effect.html">mod_effect</a></span>(fuel_mod_<span class="dv">2</span>, <span class="op">~</span><span class="st"> </span>hp, <span class="dt">hp =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">200</span>), <span class="dt">transmission =</span> <span class="st">"manual"</span>)</a></code></pre></div>
<pre><code>##         slope  hp to_hp transmission
## 1 -0.10306173 100   150       manual
## 2 -0.02649382 200   250       manual</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw"><a href="../reference/mod_effect.html">mod_effect</a></span>(fuel_mod_<span class="dv">2</span>, <span class="op">~</span><span class="st"> </span>hp, <span class="dt">nlevels =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##          slope  hp to_hp transmission
## 1 -0.075673339 100   150    automatic
## 2 -0.032461720 200   250    automatic
## 3 -0.016061279 300   350    automatic
## 4 -0.103061728 100   150       manual
## 5 -0.026493816 200   250       manual
## 6  0.002566599 300   350       manual</code></pre>
<p>By default, the step size for a quantitative variable is approximately the standard deviation. You can set the step to whatever value you want with the <code>step =</code> argument.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw"><a href="../reference/mod_effect.html">mod_effect</a></span>(fuel_mod_<span class="dv">2</span>, <span class="op">~</span><span class="st"> </span>hp, <span class="dt">step =</span> <span class="fl">0.1</span>, <span class="dt">nlevels =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>##         slope  hp to_hp transmission
## 1 -0.07865235 120 120.1    automatic</code></pre>
<p>Advice: Whatever you may have learned in calculus about limits, a finite step size is generally what you want, particularly for jagged kinds of model functions like random forests or knn. For instance, compare the effect size of <code>Sepal.Length</code> in <code>iris_mod_2</code> using a “small” step size and a step size on the order of the standard deviation of <code>Sepal.Length</code>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">  <span class="kw"><a href="../reference/mod_effect.html">mod_effect</a></span>(iris_mod_<span class="dv">2</span>, <span class="op">~</span><span class="st"> </span>Sepal.Length, <span class="dt">step =</span> <span class="fl">0.01</span>, <span class="dt">class_level =</span> <span class="st">"virginica"</span> ),</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">  <span class="kw"><a href="../reference/mod_effect.html">mod_effect</a></span>(iris_mod_<span class="dv">2</span>, <span class="op">~</span><span class="st"> </span>Sepal.Length, <span class="dt">step =</span> <span class="dv">1</span>, <span class="dt">class_level =</span> <span class="st">"virginica"</span>)</a>
<a class="sourceLine" id="cb27-4" data-line-number="4">)</a></code></pre></div>
<pre><code>##   slope_virginica Sepal.Length to_Sepal.Length Sepal.Width Petal.Length
## 1               0          5.8            5.81           3          4.4
## 2               0          5.8            6.80           3          4.4
##   Petal.Width
## 1         1.3
## 2         1.3</code></pre>
<p>The zero effect size for the small step is an artifact. The k-nearest neighbors model is piecewise constant.</p>
</div>
<div id="model-error" class="section level2">
<h2 class="hasAnchor">
<a href="#model-error" class="anchor"></a>Model error</h2>
<p>Sometimes you want to know how the model performs. The <code><a href="../reference/mod_error.html">mod_error()</a></code> function will compute the mean square error for a regression model and the log likelihood for a classification model.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw"><a href="../reference/mod_error.html">mod_error</a></span>(fuel_mod_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## Warning in mod_error(fuel_mod_2): Calculating error from training data.</code></pre>
<pre><code>##      mse 
## 5.915142</code></pre>
<p>Use the <code>testdata =</code> argument to do the calculations on specified testing data, as in cross validation.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw"><a href="../reference/mod_error.html">mod_error</a></span>(fuel_mod_<span class="dv">2</span>, <span class="dt">testdata =</span> mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,])</a></code></pre></div>
<pre><code>##      mse 
## 4.621065</code></pre>
<p>You have your choice of several measures of error. (See the documentation for <code><a href="../reference/mod_error.html">mod_error()</a></code>.) For instance, the following two commands calculate for the second iris model the classification error rate (about 3%) and the log-likelihood. (Of course, these two measures of error are on entirely different scales, so there’s no point in comparing them to each other. Generally, you compare the same error measure across two or more models.)</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw"><a href="../reference/mod_error.html">mod_error</a></span>(iris_mod_<span class="dv">2</span>, <span class="dt">error_type =</span> <span class="st">"class_error"</span>)</a></code></pre></div>
<pre><code>## Warning in mod_error(iris_mod_2, error_type = "class_error"): Calculating
## error from training data.</code></pre>
<pre><code>## class_error 
##  0.01333333</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw"><a href="../reference/mod_error.html">mod_error</a></span>(iris_mod_<span class="dv">2</span>, <span class="dt">error_type =</span> <span class="st">"LL"</span>)</a></code></pre></div>
<pre><code>## Warning in mod_error(iris_mod_2, error_type = "LL"): Calculating error from
## training data.</code></pre>
<pre><code>##        LL 
## -13.06527</code></pre>
</div>
<div id="bootstrapping" class="section level2">
<h2 class="hasAnchor">
<a href="#bootstrapping" class="anchor"></a>Bootstrapping</h2>
<p>Bootstrapping provides a broadly applicable way to characterize the sampling uncertainty in parameter estimates, model predictions, or effect sizes. To use bootstrapping, use <code><a href="../reference/mod_ensemble.html">mod_ensemble()</a></code> to create an ensemble of models all with the same architecture and parameters as the original each trained on a different bootstrap sample.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">ensemble_fuel_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mod_ensemble.html">mod_ensemble</a></span>(fuel_mod_<span class="dv">1</span>, <span class="dt">nreps =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb40-2" data-line-number="2">ensemble_iris_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mod_ensemble.html">mod_ensemble</a></span>(iris_mod_<span class="dv">1</span>, <span class="dt">nreps =</span> <span class="dv">10</span>)</a></code></pre></div>
<p>Now you can use other functions from the package, but putting the ensemble in the argument slot for the model, for instance:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw"><a href="../reference/mod_plot.html">mod_plot</a></span>(ensemble_fuel_<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="kw"><a href="../reference/mod_effect.html">mod_effect</a></span>(ensemble_iris_<span class="dv">1</span>, <span class="op">~</span><span class="st"> </span>Petal.Length)</a></code></pre></div>
<pre><code>##    slope_setosa Petal.Length to_Petal.Length Sepal.Length .trial
## 1        -0.004          4.4             5.4          5.8      1
## 2        -0.014          4.4             5.4          5.8      2
## 3        -0.012          4.4             5.4          5.8      3
## 4        -0.004          4.4             5.4          5.8      4
## 5        -0.002          4.4             5.4          5.8      5
## 6        -0.016          4.4             5.4          5.8      6
## 7         0.000          4.4             5.4          5.8      7
## 8         0.000          4.4             5.4          5.8      8
## 9        -0.014          4.4             5.4          5.8      9
## 10       -0.002          4.4             5.4          5.8     10</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw"><a href="../reference/mod_eval.html">mod_eval</a></span>(ensemble_iris_<span class="dv">1</span>, <span class="dt">nlevels =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>##    Sepal.Length Petal.Length setosa versicolor virginica .trial
## 1           5.8          4.4  0.004      0.992     0.004      1
## 2           5.8          4.4  0.016      0.962     0.022      2
## 3           5.8          4.4  0.012      0.966     0.022      3
## 4           5.8          4.4  0.004      0.972     0.024      4
## 5           5.8          4.4  0.002      0.998     0.000      5
## 6           5.8          4.4  0.016      0.960     0.024      6
## 7           5.8          4.4  0.000      0.998     0.002      7
## 8           5.8          4.4  0.000      0.996     0.004      8
## 9           5.8          4.4  0.018      0.956     0.026      9
## 10          5.8          4.4  0.002      0.996     0.002     10</code></pre>
<p><img src="Basics_files/figure-html/unnamed-chunk-20-1.png" width="45%" style="display: block; margin: auto;"></p>
<p>For effect sizes, the interest is often in knowing the standard error (just as it is for the coefficients of linear regression models). A shortcut for this is to to specify a number of bootstrap replications as an argument to <code><a href="../reference/mod_effect.html">mod_effect()</a></code> or <code><a href="../reference/mod_eval.html">mod_eval()</a></code> or <code><a href="../reference/mod_plot.html">mod_plot()</a></code>.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw"><a href="../reference/mod_effect.html">mod_effect</a></span>(fuel_mod_<span class="dv">2</span>, <span class="op">~</span><span class="st"> </span>transmission, <span class="dt">bootstrap =</span> <span class="dv">10</span>, <span class="dt">hp =</span> <span class="kw">c</span>(<span class="dv">50</span>,<span class="dv">150</span>,<span class="dv">250</span>))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   change_mean change_se transmission to_transmission    hp
##         &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;           &lt;dbl&gt;
## 1        8.22      2.41 automatic    manual             50
## 2        1.63      2.78 automatic    manual            150
## 3        3.26      3.66 automatic    manual            250</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="kw"><a href="../reference/mod_eval.html">mod_eval</a></span>(fuel_mod_<span class="dv">2</span>, <span class="dt">bootstrap =</span> <span class="dv">50</span>, <span class="dt">hp =</span> <span class="kw">c</span>(<span class="dv">50</span>,<span class="dv">150</span>))</a></code></pre></div>
<pre><code>##    hp transmission model_output model_output_se
## 1  50    automatic     25.56826       1.2754697
## 2 150    automatic     17.02476       0.7146195
## 3  50       manual     32.27537       2.6157563
## 4 150       manual     21.60856      16.4086216</code></pre>
</div>
<div id="cross-validation" class="section level2">
<h2 class="hasAnchor">
<a href="#cross-validation" class="anchor"></a>Cross validation</h2>
<p>Cross validation refers to a process of dividing the available data into two parts:</p>
<ol style="list-style-type: decimal">
<li>A <em>training</em> set used to construct the model.</li>
<li>A <em>testing</em> set used to evaluate model performance.</li>
</ol>
<p>This division between training and testing produces an unbiased estimate of error (as opposed to the traditional methods such as <span class="math inline">\(R^2\)</span> that need to be adjusted for degrees of freedom, etc.).</p>
<p>The <code><a href="../reference/mod_cv.html">mod_cv()</a></code> function automates this process, using a method called <em>k-fold cross validation</em>. A common use is to compare the performance of models.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">performance &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mod_cv.html">mod_cv</a></span>(fuel_mod_<span class="dv">1</span>, fuel_mod_<span class="dv">2</span>, <span class="dt">ntrials =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb49-2" data-line-number="2">performance</a></code></pre></div>
<pre><code>##          mse      model
## 1  11.277790 fuel_mod_1
## 2  10.066945 fuel_mod_1
## 3  11.008794 fuel_mod_1
## 4  10.615281 fuel_mod_1
## 5  10.498665 fuel_mod_1
## 6   9.771538 fuel_mod_1
## 7  10.782735 fuel_mod_1
## 8  10.531957 fuel_mod_1
## 9  11.907191 fuel_mod_1
## 10 10.065355 fuel_mod_1
## 11  8.230142 fuel_mod_2
## 12  7.906155 fuel_mod_2
## 13  8.019365 fuel_mod_2
## 14  7.844157 fuel_mod_2
## 15  7.698436 fuel_mod_2
## 16  7.814869 fuel_mod_2
## 17  8.035078 fuel_mod_2
## 18 10.359893 fuel_mod_2
## 19  8.052508 fuel_mod_2
## 20  8.126149 fuel_mod_2</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1">performance <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-2" data-line-number="2"><span class="st">  </span><span class="kw">gf_point</span>(mse <span class="op">~</span><span class="st"> </span>model)</a></code></pre></div>
<p><img src="Basics_files/figure-html/unnamed-chunk-22-1.png" width="45%" style="display: block; margin: auto;"> The result suggests a lower bias but higher variance for the second fuel model compared to the first.</p>
</div>
<div id="supported-models" class="section level2">
<h2 class="hasAnchor">
<a href="#supported-models" class="anchor"></a>Supported models</h2>
<p>Support is currently provide for a variety of model types including linear models, generalized linear models, random forests, and recursive partitioning as trained or fit by <code>lm()</code>, <code>glm()</code>, <code><a href="http://www.rdocumentation.org/packages/MASS/topics/rlm">rlm()</a></code> in the <code>stats</code> package or various functions in other packages such as <code>randomForest</code> or <code>caret</code>.</p>
<p>You can find out which model architectures are available with the command</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="kw">methods</span>(mod_eval_fun)</a></code></pre></div>
<pre><code>##  [1] mod_eval_fun.default*      mod_eval_fun.glm*         
##  [3] mod_eval_fun.knn3*         mod_eval_fun.lda*         
##  [5] mod_eval_fun.lm*           mod_eval_fun.nls*         
##  [7] mod_eval_fun.qda*          mod_eval_fun.randomForest*
##  [9] mod_eval_fun.rpart*        mod_eval_fun.train*       
## see '?methods' for accessing help and source code</code></pre>
<div id="a-note-on-carettrain" class="section level3">
<h3 class="hasAnchor">
<a href="#a-note-on-carettrain" class="anchor"></a>A note on caret::train()</h3>
<p>The <code>train</code> method above refers to models built with the <code>caret</code> package’s function <code><a href="http://www.rdocumentation.org/packages/caret/topics/train">train()</a></code>. One of the major points of <code>caret</code> is to allow the user to optimize the parameters for the training. If you do this when constructing a model, be aware that the training and optimizing will occur every time a bootstrap replication or cross-validation run is made. This can dramatically expand the time required for these operations. One way to find out how much the required time is expanded is to make a small bootstrap ensemble with <code><a href="../reference/mod_ensemble.html">mod_ensemble()</a></code>. To avoid the retraining with <code>caret</code> models, you can pull the <code>finalModel</code> component out of the object created by <code><a href="http://www.rdocumentation.org/packages/caret/topics/train">train()</a></code>. But while the train object will often work, the <code>finalModel</code> may be of a type not recognized by this package. See the section on <span id="new-architectures">new model architectures</span>.</p>
</div>
</div>
<div id="new-architectures" class="section level2">
<h2 class="hasAnchor">
<a href="#new-architectures" class="anchor"></a>Adding new model architectures</h2>
<p>The package authors would like to have this package ready-to-run with commonly used model architectures. If you have a suggestion, please forward it.</p>
<p>R programmers can add their own model architectures by adding S3 methods for these functions:</p>
<ul>
<li><code><a href="../reference/formula_from_mod.html">formula_from_mod()</a></code></li>
<li><code><a href="../reference/data_from_mod.html">data_from_mod()</a></code></li>
<li><p><code><a href="../reference/mod_eval_fun.html">mod_eval_fun()</a></code> evaluates the model at specified values of the input variables. This is much like <code>predict()</code>, from which it is often built.</p></li>
<li><p><code><a href="../reference/construct_fitting_call.html">construct_fitting_call()</a></code></p></li>
</ul>
<p>Depending on the model type of interest, the default methods of some or all of these may work without modification. You can test this my running each function on several models to see if the desired results are produced.</p>
<p>If you need to create custom methods for your model objects, you can inspect the code for the the methods provided in the <code>mosaicModel</code> for examples that should give you some idea how to write your own methods.</p>
<p>To illustrate, let’s add a set of methods for the classification models produced by <code><a href="http://www.rdocumentation.org/packages/MASS/topics/lda">MASS::lda()</a></code> and <code><a href="http://www.rdocumentation.org/packages/MASS/topics/qda">MASS::qda()</a></code>.</p>
<p>Step 1 is to create a model (or better, several models)</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="kw">library</span>(MASS)</a>
<a class="sourceLine" id="cb54-2" data-line-number="2">my_mod &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/MASS/topics/lda">lda</a></span>(Species <span class="op">~</span><span class="st"> </span>Petal.Length <span class="op">+</span><span class="st"> </span>Petal.Width, <span class="dt">data =</span> iris)</a></code></pre></div>
<p>For this model, three of the four required functions work with the default method. <code><a href="../reference/formula_from_mod.html">formula_from_mod()</a></code> should return a formula with the response variable on the left and the predictors on the right.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="kw"><a href="../reference/formula_from_mod.html">formula_from_mod</a></span>(my_mod)</a></code></pre></div>
<pre><code>## Species ~ Petal.Length + Petal.Width</code></pre>
<p><code><a href="../reference/data_from_mod.html">data_from_mod()</a></code> must extract the original data (or training) used to fit the model.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw"><a href="../reference/data_from_mod.html">data_from_mod</a></span>(my_mod) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">3</span>)</a></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa</code></pre>
<!-- RJP: Since the functions below are not exported, and no action is required,  -->
<!-- I'm not sure we need to include this in the vignette. -->
<!-- Since these two are working for `lda`/`qda`, the `response_var()`, `explanatory_vars()` and `response_values()` will also work without  -->
<!-- modification. -->
<!-- ```{r} -->
<!-- mosaicModel:::response_var(my_mod) -->
<!-- mosaicModel:::explanatory_vars(my_mod) -->
<!-- mosaicModel:::response_values(my_mod) -->
<!-- ``` -->
<p>The <code>call_from_mod()</code> function returns a “call,” which is unfamiliar to many R users. It should look like the original call that constructed the model, as it does here.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw"><a href="../reference/construct_fitting_call.html">construct_fitting_call</a></span>(my_mod, <span class="dt">data_name =</span> <span class="st">"placeholder"</span>)</a></code></pre></div>
<pre><code>## lda(formula = Species ~ Petal.Length + Petal.Width, data = placeholder)</code></pre>
<p>Many models store the information needed for these functions internally so that it is relatively easy to extract, often the default method works. For models that do not, we suggest writing a wrapper function that calls the original function and then adds some additional information to the model to make these functions easily computed.</p>
<p>Finally we need to create <code><a href="../reference/mod_eval_fun.html">mod_eval_fun()</a></code> method. The default methods do not work here, so we have some work to do.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">mosaicModel<span class="op">:::</span><span class="kw">mod_eval_fun.default</span>(my_mod)</a></code></pre></div>
<p>This is not atypical because the various model constructing functions store the information required for this in many different ways. Let’s take a look at how <code><a href="../reference/mod_eval_fun.html">mod_eval_fun()</a></code> works for models of class <code>knn3</code>.</p>
<p>To start, let’s see if there is a <code>predict()</code> method defined.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1"><span class="kw">methods</span>(<span class="dt">class =</span> <span class="st">"lda"</span>)</a></code></pre></div>
<pre><code>## [1] coef         mod_eval_fun model.frame  pairs        plot        
## [6] predict      print       
## see '?methods' for accessing help and source code</code></pre>
<p>There is. This is a pretty common practice among those writing model-training functions. Regretably, there is considerable variety in the programming interface to <code>predict()</code> methods, so it’s quite common to have to implement a wrapper function around any existing <code>predict()</code> method so that it can be used with <code>mosaicModel</code>.</p>
<p>We can use <code>args()</code> to see what the argument names are for this method and refer to the help page for <code><a href="http://www.rdocumentation.org/packages/MASS/topics/predict.lda">predict.lda()</a></code> to see how they are used.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="kw">args</span>(MASS<span class="op">:::</span>predict.lda)</a></code></pre></div>
<pre><code>## function (object, newdata, prior = object$prior, dimen, method = c("plug-in", 
##     "predictive", "debiased"), ...) 
## NULL</code></pre>
<p><code>newdata =</code> is often the name of the argument for specifying the model inputs, but sometimes it’s <code>x</code> or <code>data</code> or whatever.</p>
<p>Since <code>lda</code>/<code>qda</code> is a classifier, the form of output we would like to produce is a table of probabilities for each class level for each input class. This is the standard expected by <code>mosaicModel</code>. Let’s look at the output of <code>predict()</code>:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="kw">predict</span>(my_mod) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>## List of 3
##  $ class    : Factor w/ 3 levels "setosa","versicolor",..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ posterior: num [1:150, 1:3] 1 1 1 1 1 ...
##   ..- attr(*, "dimnames")=List of 2
##   .. ..$ : chr [1:150] "1" "2" "3" "4" ...
##   .. ..$ : chr [1:3] "setosa" "versicolor" "virginica"
##  $ x        : num [1:150, 1:2] -6.04 -6.04 -6.2 -5.89 -6.04 ...
##   ..- attr(*, "dimnames")=List of 2
##   .. ..$ : chr [1:150] "1" "2" "3" "4" ...
##   .. ..$ : chr [1:2] "LD1" "LD2"</code></pre>
<p>This is something of a detective story, but a person very familiar with <code><a href="http://www.rdocumentation.org/packages/MASS/topics/lda">lda()</a></code> and with R will see that the <code>predict</code> method produces a list of two items. The second one called <code>posterior</code> and is a matrix with 150 rows and 3 columns, corresponding to the size of the training data.</p>
<p>Once located, do what you need in order to coerce the output to a data frame and remove row names (for consistency of output). Here’s the <code>mod_eval_fun.lda()</code> function from <code>mosaicModel</code>.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1">mosaicModel<span class="op">:::</span>mod_eval_fun.lda</a></code></pre></div>
<pre><code>## function(model, data = NULL, interval = "none", ...) {
##   if (is.null(data)) data &lt;- data_from_mod(model)
## 
##   res &lt;- as.data.frame(predict(model, newdata = data)$posterior)
## 
##   tibble::remove_rownames(res)
## }
## &lt;bytecode: 0x7f80ecec1948&gt;
## &lt;environment: namespace:mosaicModel&gt;</code></pre>
<p>The arguments to the function are the same as for all the <code><a href="../reference/mod_eval_fun.html">mod_eval_fun()</a></code> methods. The body of the function pulls out the <code>posterior</code> component, coerces it to a data frame and removes the row names. It isn’t always this easy. But once the function is available in your session, you can test it out. (Make sure to give it a data set as inputs to the model)</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1"><span class="kw"><a href="../reference/mod_eval_fun.html">mod_eval_fun</a></span>(my_mod, <span class="dt">data =</span> iris[<span class="kw">c</span>(<span class="dv">30</span>, <span class="dv">80</span>, <span class="dv">120</span>),])</a></code></pre></div>
<pre><code>##         setosa   versicolor    virginica
## 1 1.000000e+00 9.606455e-11 1.178580e-24
## 2 2.588683e-05 9.999735e-01 6.615331e-07
## 3 3.932322e-16 8.612009e-01 1.387991e-01</code></pre>
<p>Now the high-level functions in <code>mosaicModel</code> can work on LDA models.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1"><span class="kw"><a href="../reference/mod_effect.html">mod_effect</a></span>(my_mod, <span class="op">~</span><span class="st"> </span>Petal.Length, <span class="dt">bootstrap =</span> <span class="dv">10</span>,  </a>
<a class="sourceLine" id="cb72-2" data-line-number="2">           <span class="dt">class_level =</span> <span class="st">"virginica"</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   slope_virginica… slope_virginica… Petal.Length to_Petal.Length
##              &lt;dbl&gt;            &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;
## 1            0.113            0.151          4.4             5.4
## # ... with 1 more variable: Petal.Width &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1"><span class="kw"><a href="../reference/mod_plot.html">mod_plot</a></span>(my_mod, <span class="dt">bootstrap =</span> <span class="dv">10</span>, <span class="dt">class_level =</span> <span class="st">"virginica"</span>)</a></code></pre></div>
<p><img src="Basics_files/figure-html/unnamed-chunk-35-1.png" width="45%" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introductory-examples">Introductory examples</a></li>
      <li><a href="#model-outputs">Model outputs</a></li>
      <li><a href="#effect-sizes">Effect sizes</a></li>
      <li><a href="#model-error">Model error</a></li>
      <li><a href="#bootstrapping">Bootstrapping</a></li>
      <li><a href="#cross-validation">Cross validation</a></li>
      <li><a href="#supported-models">Supported models</a></li>
      <li><a href="#new-architectures">Adding new model architectures</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kaplan Daniel, Pruim Randall.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
